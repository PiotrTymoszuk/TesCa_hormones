---
title: "Histology and pre-surgery sex hormone levels in testicular cancer"
subtitle: "Short analysis report"
author: "Piotr Tymoszuk for the Department of Urology"
date: "`r format(Sys.time(), '%Y-%m-%d')`"

output: 
  bookdown::html_document2:
    css: "style.css"
    
bibliography: tesca.bib

csl: frontiers_medical.csl

header-includes:
  \usepackage{longtable}
  \usepackage{tabu}
  \usepackage{caption}
  \usepackage{makecell}
  \usepackage{pdflscape}
  \usepackage{array}
  \usepackage{booktabs}
  \usepackage{threeparttable}
  \usepackage{threeparttablex}
  \usepackage{wrapfig}
  \usepackage{multirow}
  \usepackage[normalem]{ulem}
  \usepackage{colortbl}
  \usepackage{xcolor}
  \usepackage{float} \floatplacement{figure}{H} \floatplacement{table}{H}

---

```{r, setup, include = FALSE}


opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      dev = "png", 
                      dpi = 600)

set_flextable_defaults(font.family = "Helvetica", 
                       font.size = 10)


```


<center>

![](logo_large.png){#id .class width="40mm"}

</center>

<hr style = "border-top: 5px solid DarkGray" />


# Analysis summary

* A total of `r nrow(tesca$data)` testicle cancer patients with survival information available were analyzed in the current report

<hr style = "border-top: 5px solid #417a8b" />

# Analysis strategy

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-inclusion-scheme, fig.width = figur::convert(figures$inclusion, to = 'in')$w, fig.height = figur::convert(figures$inclusion, to = 'in')$h, fig.cap = 'Analysis inclusion scheme and data analysis strategy.'}

figures$inclusion$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-inclusion-scheme). Analysis inclusion scheme and data analysis strategy.</b>
</p>

<hr style = "border-top: 5px solid #417a8b" />

# Explorative data analysis

## Study variables, data missingness and variability

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-study-vars, tab.cap = 'Study variables.'}

flextable::flextable(tables$study_vars) %>% 
  width(1, width = 2.7, unit = 'cm') %>% 
  width(2, width = 7, unit = 'cm') %>% 
  width(3, width = 3, unit = 'cm') %>% 
  width(4, width = 3, unit = 'cm') %>% 
  width(5, width = 1.8, unit = 'cm') %>% 
  theme_vanilla

```

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-missing, fig.width = figur::convert(figures$missing, to = 'in')$w, fig.height = figur::convert(figures$missing, to = 'in')$h, fig.cap = 'Missing data per participant and variable.'}

figures$missing$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-missing). Missing data per participant and variable.</b>
<br>
Percentages of missing observations per participant (A) and variable (B) are presented in a histogram and bar plot, respectively. Total number of participants with survival information included in the analysis and the number of study variables are displayed in the plot captions.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-gini, fig.width = figur::convert(figures$gini, to = 'in')$w, fig.height = figur::convert(figures$gini, to = 'in')$h, fig.cap = 'Information content of the variables measured by Gini coefficient.'}

figures$gini$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-gini). Information content of the variables measured by Gini coefficient.</b>
<br>
Gini coefficients serving as measures of variable information content are presented in a bar plot.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-miss-inf, tab.cap = 'Percentage of missing records and Gini coefficients as measure of information content of the study variables.'}

flextable::flextable(tables$miss_inf) %>% 
  width(1, width = 6, unit = 'cm') %>% 
  width(2:5, width = 3, unit = 'cm') %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid DarkGray" />

## Distribution of the study variables

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-normality, fig.width = figur::convert(figures$normailty, to = 'in')$w, fig.height = figur::convert(figures$normailty, to = 'in')$h, fig.cap = 'Normality of numeric study variables assessed by Shapiro-Wilk test.'}

figures$normailty$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-normality). Normality of numeric study variables assessed by Shapiro-Wilk test.</b>
<br>
Normality of distribution of numeric study variables following the identity, logarithm (log) and squared root (sqrt) transformation was assessed by Shapiro-Wilk test. Values of the test statistic W (0: highly non-normal distribution, 1: perfect normality) are presented in a bar plot.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-best-transformation, tab.cap = 'Normality assessment by Shapiro-Wilk test for the optimal normality-improving transformations of the numeric study variables.'}

flextable::flextable(tables$best_transf) %>% 
  width(1, width = 4, unit = 'cm') %>% 
  width(2:5, width = 3, unit = 'cm') %>% 
  merge_v(1) %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid #417a8b" />

# Characteristic of the study cohort

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-cohort-demo-cancer, tab.cap = 'Demographic and cancer-related characteristic of the study cohort. Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$cohort_demo_cancer) %>% 
  width(1, width = 8, unit = 'cm') %>% 
  width(2, width = 4.5, unit = 'cm') %>% 
  footnote(1, 1, 
           value = as_paragraph('IGCCCG: International Germ Cell Cancer Collaborative Group; AFP: alpha fetoprotein; LDH: lactate dehydrogenase; HCG: human chorionic gonadotropin.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  theme_vanilla

```

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-cohort-hormones, tab.cap = 'Pre-surgery levels of sex hormones in the study cohort. Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$cohort_hormones) %>% 
  width(1, width = 6, unit = 'cm') %>% 
  width(2, width = 6, unit = 'cm') %>% 
  footnote(1, 1, 
           value = as_paragraph('T: testosterone; E2: estradiol; SHBG: sex hormone binding globulin; PRL: prolactin; FSH: follicle-stimulating hormone; LH: luteinizing hormone.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid #417a8b" />

# Seminoma and non-seminomatous germ cell tumors

## Differences in demographic, pathologic cand endocrinologic features

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-cancer, fig.width = figur::convert(figures$histology_cancer, to = 'in')$w, fig.height = figur::convert(figures$histology_cancer, to = 'in')$h, fig.cap = 'Significant differences in demographic and cancer features between seminoma and non-seminomatous germ cell tumors (NSGCT).'}

figures$histology_cancer$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-cancer). Significant differences in demographic and cancer features between seminoma and non-seminomatous germ cell tumors (NSGCT).</b>
<br>
Differences in age at cancer surgery and alpha fetoprotein (AFP) blood concentration between the histology types were assessed by Mann-Whitney test with r effect size statistic. Differences in distribution of tumor stages, Lugano classes (CS Lugano), IGCCCG (International Germ Cell Cancer Collaborative Group) risk classes, and frequency of lymphovascular invasion between the histology types were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate (FDR). Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of complete observations are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-therapy, fig.width = figur::convert(figures$histology_therapy, to = 'in')$w, fig.height = figur::convert(figures$histology_therapy, to = 'in')$h, fig.cap = 'Differences in frequency of retroperitoneal lymphadenectomy chemo- and radiotherapy between seminoma and non-seminomatous germ cell tumors (NSGCT).'}

figures$histology_therapy$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-therapy). Differences in frequency of retroperitoneal lymphadenectomy chemo- and radiotherapy between seminoma and non-seminomatous germ cell tumors (NSGCT).</b>
<br>
Differences in frequency of retroperitoneal lymphadenectomy (RLA), chemo- and radiotherapy between the histological types were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with false-discovery rate (FDR) method. Frequencies are presented in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of complete observations are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />


```{r tab-histology-demo-cancer, tab.cap = 'Demographic and cancer-related characteristic of study participants with seminomas and non-seminomatous germ cell tumors (NSGCT). Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$histology_demo_cancer) %>% 
  width(1, width = 3.5, unit = 'cm') %>% 
  width(2:3, width = 4, unit = 'cm') %>% 
  width(4, width = 2.3, unit = 'cm') %>% 
  width(5, width = 2.1, unit = 'cm') %>%
  footnote(1, 1, 
           value = as_paragraph('IGCCCG: International Germ Cell Cancer Collaborative Group; AFP: alpha fetoprotein; LDH: lactate dehydrogenase; HCG: human chorionic gonadotropin.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  footnote(1, 4:5, 
           value = as_paragraph('Numeric variables: Mann-Whitney test with r effect size statistic. Categorical variables: \u03C7\u00B2 test with Cramer V effect size statistic. P values corrected for multiple testing with the false discovery rate method.'), 
           part = 'header', 
           ref_symbols = 'b') %>% 
  theme_vanilla

```

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-estro-testo-hcg, fig.width = figur::convert(figures$histology_estro_testo_hcg, to = 'in')$w, fig.height = figur::convert(figures$histology_estro_testo_hcg, to = 'in')$h, fig.cap = 'Differences in pre-surgery levels of testosterone, estradiol and human chorionic gonadotropin between seminoma and non-seminomatous germ cell tumors (NSGCT).'}

figures$histology_estro_testo_hcg$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-estro-testo-hcg). Differences in pre-surgery levels of testosterone, estradiol and human chorionic gonadotropin between seminoma and non-seminomatous germ cell tumors (NSGCT).</b>
<br>
Differences in blood concentrations of testosterone (T), estradiol (E2) and human chorionic gonadotropin (HCG) between the histology types were assessed by Mann-Whitney test with r effect size statistic. Differences in frequency of clinical strata of hormone levels were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate (FDR) method. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of complete observations are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-fsh-ld-prl, fig.width = figur::convert(figures$histology_fsh_ld_prl, to = 'in')$w, fig.height = figur::convert(figures$histology_fsh_ld_prl, to = 'in')$h, fig.cap = 'Differences in pre-surgery levels of follicle-stimulating hormone, luteinizing hormone and prolactin between seminoma and non-seminomatous germ cell tumors (NSGCT).'}

figures$histology_fsh_ld_prl$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-fsh-ld-prl). Differences in pre-surgery levels of follicle-stimulating hormone, luteinizing hormone and prolactin between seminoma and non-seminomatous germ cell tumors (NSGCT).</b>
<br>
Differences in blood concentrations of follicle-stimulating hormone (FSH), luteinizing hormone (LH) and prolactin (PRL) between the histology types were assessed by Mann-Whitney test with r effect size statistic. Differences in frequency of clinical strata of hormone levels were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate (FDR) method. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of complete observations are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-histology-hormones, tab.cap = 'Pre-surgery levels of sex hormones in study participants with seminomas and non-seminomatous germ cell tumors (NSGCT). Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$histology_hormones) %>% 
  width(1, width = 3.5, unit = 'cm') %>% 
  width(2:3, width = 4, unit = 'cm') %>% 
  width(4, width = 2.3, unit = 'cm') %>% 
  width(5, width = 2.1, unit = 'cm') %>%
  footnote(1, 1, 
           value = as_paragraph('T: testosterone; E2: estradiol; FSH:  follicle-stimulating hormone; LH: luteinizing hormone; PRL: prolactin.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  footnote(1, 4:5, 
           value = as_paragraph('Numeric variables: Mann-Whitney test with r effect size statistic. Categorical variables: \u03C7\u00B2 test with Cramer V effect size statistic. P values corrected for multiple testing with the false discovery rate method.'), 
           part = 'header', 
           ref_symbols = 'b') %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid DarkGray" />

## Multi-parameter signature of histology types

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-class, fig.width = figur::convert(figures$histology_classifier, to = 'in')$w, fig.height = figur::convert(figures$histology_classifier, to = 'in')$h, fig.cap = 'Multi-parameter clinical signature of non-seminomatous germ cell tumors (NSGCT) established by conditional Random Forest modeling.'}

figures$histology_classifier$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-class). Multi-parameter clinical signature of non-seminomatous germ cell tumors (NSGCT) cancers established by conditional Random Forest modeling.</b>
<br>
Multi-parameter model employing demographic, clinical, pathological, therapy and hormone explanatory variables for discrimination between seminoma and NSGCT histology cancers was developed with the conditional Random Forest algorithm and corroborated by 10-fold cross-validation (CV).
<br>
(A) Permutation importance of explanatory variables expressed as difference in accuracy ($\Delta$ accuracy) between the original model and the model with a particular variable randomly re-shuffled. Accuracy differences are displayed in a bar plot. Numbers of samples in the histology types are shown in the plot caption.
<br>
(B) Discriminant performance of the Random Forest model in the original data set and 10-fold CV was assessed by receiver-operating characteristic (ROC). Calibration of the model was investigated with Brier Score. Fit statistics: $R^2$, Cohen's $\kappa$, area under the ROC curve (AUC), sensitivity (Se), specificity (Sp) and integrated Brier Score (IBS) are presented in the plot captions and in the plots.
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Relapse in seminoma and non-seminomatous germ cell tumors (NSGCT)

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-survival, fig.width = figur::convert(figures$histology_survival, to = 'in')$w, fig.height = figur::convert(figures$histology_survival, to = 'in')$h, fig.cap = 'Relapse-free survival in patients with seminoma and non-seminomatous germ cell tumors (NSGCT).'}

figures$histology_survival$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-survival). Relapse-free survival in patients with seminoma and non-seminomatous germ cell tumors (NSGCT).</b>
<br>

Differences in relapse-free survival between seminoma and NSGCT histology cancers were assessed by log-rank test. Fractions of surviving individuals are presented in a Kaplan-Meier plot. Numbers of observations and relapses are displayed in the plot caption. The test p value is shown in the the plot.
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Histology of testicle cancer, result summary

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-histology-summary, fig.width = figur::convert(figures$histology_summary, to = 'in')$w, fig.height = figur::convert(figures$histology_summary, to = 'in')$h, fig.cap = 'Key differences between seminoma and non-seminomatous germ cell tumors.'}

figures$histology_summary$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-histology-summary). Key differences between seminoma and non-seminomatous germ cell tumors.</b>
</p>

<hr style = "border-top: 5px solid #417a8b" />

# Pre-surgery blood levels of sex hormones

## Components of pre-surgery sex hormone levels in testicle cancer

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-hormone-components, fig.width = figur::convert(figures$hormone_components, to = 'in')$w, fig.height = figur::convert(figures$hormone_components, to = 'in')$h, fig.cap = 'Component analysis of pre-surgery sex hormone levels.'}

figures$hormone_components$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-hormone-components). Component analysis of pre-surgery sex hormone levels.</b>
<br>
Blood concentrations of sex hormones (T: testosterone, E2: estradiol, FSH: follicle stimulating hormone, LH: luteinizing hormone; PRL: prolactin) as numeric variables and as clinical strata were subjected to 4-dimensional principal component analysis (PCA, A) and multidimensional correspondence analysis (MCA, B). Loadings (PCA) and column factors (MCA) for the first two dimensions are presented in the plots. Numbers of observations are indicated in the plot captions.
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Definition of the hormonal subsets of testicle cancer

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-lca-tuning, fig.width = figur::convert(figures$lca_tuning, to = 'in')$w, fig.height = figur::convert(figures$lca_tuning, to = 'in')$h, fig.cap = 'Determination of the optimal number of hormonal subsets of testicle cancer with latent class analysis.'}

figures$lca_tuning$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-lca-tuning). Determination of the optimal number of hormonal subsets of testicle cancer with latent class analysis.</b>
<br>
Hormonal subsets of testicle cancer were defined latent class analysis (LCA) employing clinical strata of pre-surgery blood concentration of sex hormones (T: testosterone, E2: estradiol, FSH: follicle stimulating hormone, LH: luteinizing hormone, PRL: prolactin). Goodness of fit of the LCA models for various subset numbers was measured by Bayesian Information Criterion (BIC). Note improving goodness of fit with decreasing BIC. BIC values for the investigated class numbers are presented in a line plot. The vertical dashed line indicates the subset number chosen for the final model.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-lca-posterior, tab.cap = 'Posterior probabilities of the hormonal subset assignment obtained by latent class analysis. The table is available in a supplementary Excel file.'}

tables$lca_posterior[1, 1] %>% 
  mutate(`Participant ID` = '') %>% 
  set_names(' ') %>% 
  flextable

```

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-latent-classes, fig.width = figur::convert(figures$latent_classes, to = 'in')$w, fig.height = figur::convert(figures$latent_classes, to = 'in')$h, fig.cap = 'Hormonal subsets of testis cancer patients defined by latent class analysis in respect to pre-surgery strata of sex hormones.'}

figures$latent_classes$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-latent-classes). Hormonal subsets of testis cancer patients defined by latent class analysis in respect to pre-surgery strata of sex hormones.</b>
<br>
Distribution of clinical strata of pre-surgery sex hormone levels in the hormone subsets of testicle cancer defined by latent class analysis (T: testosterone, E2: estradiol, FSH: follicle stimulating hormone, LH: luteinizing hormone, PRL: prolactin). Statistical significance was determined by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate method. Strata frequencies within the hormonal subsets are presented in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-hormone-classes, fig.width = figur::convert(figures$hormone_classes, to = 'in')$w, fig.height = figur::convert(figures$hormone_classes, to = 'in')$h, fig.cap = 'Pre-surgery blood concentrations of sex hormones in the hormonal subsets of testis cancer.'}

figures$hormone_classes$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-hormone-classes). Pre-surgery blood concentrations of sex hormones in the hormonal subsets of testis cancer.</b>
<br>
Normalized pre-surgery blood concentrations of sex hormones (Z-scores; T: testosterone, E2: estradiol, FSH: follicle stimulating hormone, LH: luteinizing hormone, PRL: prolactin) were compared between the hormonal subsets of testicle cancer defined by latent class analysis by Kruskal-Wallis test with $\eta^2$ effect size statistic. P values were corrected for multiple testing with the false discovery rate method. Mean values with 2 $\times$ SEM are presented as solid lines with tinted ribbons in a radar plot. Effect sizes and p values are indicated in the plot. Numbers of observations in the subsets are displayed in the plot legend. - 
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Differences in demographic, clinical and pathological cancer features between the hormonal subsets

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-demography-classes, fig.width = figur::convert(figures$classes_demography, to = 'in')$w, fig.height = figur::convert(figures$classes_demography, to = 'in')$h, fig.cap = 'Differences in age and body mass index between the hormonal subsets of testis cancer.'}

figures$classes_demography$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-demography-classes). Differences in age and body mass index between the hormonal subsets of testis cancer.</b>
<br>
Differences in age and body mass index (BMI) between the hormonal subsets were assessed by Kruskal-Wallis test with $\eta^2$ effect size statistic. Differences in distribution of body mass classes were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple comparisons with the false discovery rate. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-pathology, fig.width = figur::convert(figures$classes_pathology, to = 'in')$w, fig.height = figur::convert(figures$classes_pathology, to = 'in')$h, fig.cap = 'Pathological cancer characteristic in the hormonal subsets of testis cancer.'}

figures$classes_pathology$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-pathology). Pathological cancer characteristic in the hormonal subsets of testis cancer.</b>
<br>
Differences in maximal tumor size between the hormonal subsets were were assessed by Kruskal-Wallis test with $\eta^2$ effect size statistic. Differences in distribution of tumor stages and Lugano classes (CS Lugano), and frequencies of lymphovascular invasion (LVI) and histology types between the hormonal subsets were investigated by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-histology, fig.width = figur::convert(figures$classes_histology, to = 'in')$w, fig.height = figur::convert(figures$classes_histology, to = 'in')$h, fig.cap = 'Percentages of seminoma, teratoma, embryonic and yolk sac cancer histology in the hormonal subsets.'}

figures$classes_histology$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-histology). Percentages of seminoma, teratoma, embryonic and yolk sac cancer histology in the hormonal subsets.</b>
<br>
Differences in percentages of cancer histological types between the the hormonal subsets were assessed by Kruskal-Wallis test with $\eta^2$ effect size statistic. The percentages are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-markers, fig.width = figur::convert(figures$classes_markers, to = 'in')$w, fig.height = figur::convert(figures$classes_markers, to = 'in')$h, fig.cap = 'Blood levels of biochemical cancer markers in the hormonal subsets of testis cancer.'}

figures$classes_markers$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-markers). Blood levels of biochemical cancer markers in the hormonal subsets of testis cancer.</b>
<br>
Differences in blood concentrations of alpha fetoprotein (AFP) and activity of lactate dehydrogenase (LDH) were compared between the hormonal subsets by Kruskal-Wallis test with $\eta^2$ effect size statistic. Differences in distribution of AFP and LDH strata were assessed by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate method. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-therapy, fig.width = figur::convert(figures$classes_therapy, to = 'in')$w, fig.height = figur::convert(figures$classes_therapy, to = 'in')$h, fig.cap = 'Therapy in the hormonal subsets of testis cancer.'}

figures$classes_therapy$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-therapy). Therapy in the hormonal subsets of testis cancer.</b>
<br>
Rates of retroperitoneal lymphadenectomy (RLA), chemo- and radiotherapy in the hormonal subsets were compared by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate method. Therapy frequencies in the subsets are presented in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-classes, tab.cap = 'Demographic and clinical characteristic of participant subsets developed by latent class analysis in respect to pre-surgery sex hormone levels. Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$classes) %>% 
  width(1, width = 3.5, unit = 'cm') %>% 
  width(2:4, width = 4, unit = 'cm') %>% 
  width(5, width = 2.3, unit = 'cm') %>% 
  width(6, width = 2.1, unit = 'cm') %>%
  footnote(1, 1, 
           value = as_paragraph('IGCCCG: International Germ Cell Cancer Collaborative Group; AFP: alpha fetoprotein; LDH: lactate dehydrogenase; SHBG: sex hormone binding globulin; HCG: human chorionic gonadotropin.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  footnote(1, 5:6, 
           value = as_paragraph('Numeric variables: Mann-Whitney test with r effect size statistic. Categorical variables: \u03C7\u00B2 test with Cramer V effect size statistic. P values corrected for multiple testing with the false discovery rate method.'), 
           part = 'header', 
           ref_symbols = 'b') %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid DarkGray" />

## Multi-paramater signature of the hormonal subsets of testicle cancer

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-random-forest, fig.width = figur::convert(figures$classes_random_forest, to = 'in')$w, fig.height = figur::convert(figures$classes_random_forest, to = 'in')$h, fig.cap = 'Demographic and clinical signature of the hormonal subsets of testis cancer developed by conditional Random Forest modeling.'}

figures$classes_random_forest$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-random-forest). Demographic and clinical signature of the hormonal subsets of testis cancer developed by conditional Random Forest modeling.</b>
<br>
Multi-parameter model employing demographic, clinical, pathological, therapy and hormone explanatory variables for discrimination between the hormonal subsets of testicle cancer was developed with the conditional Random Forest algorithm and corroborated by 10-fold cross-validation (CV).
<br>
(A) Permutation importance of explanatory variables expressed as difference in accuracy ($\Delta$ accuracy) between the original model and the model with a particular variable randomly re-shuffled. Accuracy differences are displayed in a bar plot. Numbers of samples in the hormonal subsets are shown in the plot caption.
<br>
(B) Discriminant performance of the Random Forest model in the original data set and 10-fold CV was visualized as heat maps of 
confusion matrices. The overall subset assignment accuracy and Cohen's $\kappa$ are displayed in the plot captions. Fractions of observations correctly assigned to the neutral, testicle and pituitary subsets are indicated in X axes.
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Survival in the hormonal subsets

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-survival, fig.width = figur::convert(figures$classes_survival, to = 'in')$w, fig.height = figur::convert(figures$classes_survival, to = 'in')$h, fig.cap = 'Relapse-free survival in the hormonal subsets of testis cancer.'}

figures$classes_survival$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-survival). Relapse-free survival in the hormonal subsets of testis cancer.</b>
<br>
Differences in relapse-free survival in the hormonal subsets were assessed by log-rank test. Fractions of surviving patients are displayed in a Kaplan-Meier plot. The test p value is presented in the plot. Numbers of observations and relapses are shown in the plot caption.
</p>

<hr style = "border-top: 5px solid DarkGray" />

## Hormonal subsets and AFP/HCG-positivity status

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-marker, fig.width = figur::convert(figures$classes_marker_status, to = 'in')$w, fig.height = figur::convert(figures$classes_marker_status, to = 'in')$h, fig.cap = 'Alpha fetoprotein and human chorionic gonadotropin marker status in the hormonal subsets.'}

figures$classes_marker_status$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-marker). Alpha fetoprotein and human chorionic gonadotropin marker status in the hormonal subsets.</b>
<br>
Patients were stratified according to positivity of alpha fetoprotein (AFP, cutoff: 7 ng/mL) and human chorionic gonadotropin (HCG, cutoff: 2 IU/L): the AFP/HCG- patients were negative for both markers and AFP/HCG+ patients were positive for at least one of the markers. Differences in AFP/HCG status between the hormonal subsets were assessed by $\chi^2$ test with Cramer V effect size statistic. Frequencies of AFP/HCG strata are presented in a stack plot. The effect size and p value are displayed in the plot caption. Numbers of observations in the hormonal subsets are indicated in the X axis.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-marker-cancer, fig.width = figur::convert(figures$marker_cancer, to = 'in')$w, fig.height = figur::convert(figures$marker_cancer, to = 'in')$h, fig.cap = 'Significant differences in tumor pathology between neutral and pituitary hormonal subset participants split by the alpha fetoprotein and human chorionic gonadotropin status.'}

figures$marker_cancer$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-marker-cancer). Significant differences in tumor pathology between neutral and pituitary hormonal subset participants split by the alpha fetoprotein and human chorionic gonadotropin status.</b>
<br>
Patients were stratified according to positivity of alpha fetoprotein (AFP, cutoff: 7 ng/mL) and human chorionic gonadotropin (HCG, cutoff: 2 IU/L): the AFP/HCG- patients were negative for both markers and AFP/HCG+ patients were positive for at least one of the markers. Subsequently, differences in study variables between AFP/HCG- and AFP/HCG+ patients from the neutral and pituitary hormone subset were investigates. Differences in maximal tumor size (A) and lactate dehydrogenase activity (LDH, B) were assessed by Mann-Whitney test with r effect size statistic. Differences in tumor stages, Lugano classes, rates of lymphovascular invasion (LVI) and distribution of histological types (NSGCT: non-seminomatous germ cell tumors) were assessed by $\chi^2$ test with Cramer V effect size statistic. P values were corrected for multiple testing with the false discovery rate method. Numeric variables are presented in violin plots with single observations depicted as points, and medians with interquartile ranges represented by red diamonds and whiskers. Frequencies for levels of categorical variables are shown in stack plots. Effect sizes and p values are displayed in the plot captions. Numbers of observations in the subsets are indicated in the X axes.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-classes-markers, tab.cap = 'Significant differences in neutral and pituitary hormonal subset participants split by cancer marker positivity. Numeric variables are presented as medians with interqurtile ranges (IQR) and ranges. Categorical variables are presented as percentages and counts within the complete observation set.'}

flextable::flextable(tables$classes_markers) %>% 
  width(1, width = 3, unit = 'cm') %>% 
  width(2, width = 3.5, unit = 'cm') %>% 
  width(3:4, width = 3.5, unit = 'cm') %>% 
  width(5, width = 2.5, unit = 'cm') %>% 
  width(6, width = 2.3, unit = 'cm') %>% 
  merge_v(1) %>% 
  footnote(1,2, 
           value = as_paragraph('LDH: lactate dehydrogenase'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  footnote(1, 3:4, 
           value = as_paragraph('AFP: alpha fetoprotein; HCG: human chorionic gonadotropin; AFP/HCG-: negative for both AFP and HCG; AFP/HCG+: positive for AFP or HCG.'), 
           part = 'header', 
           ref_symbols = 'b') %>% 
  footnote(1, 5:6, 
           value = as_paragraph('Numeric variables: Mann-Whitney test with r effect size statistic. Categorical variables: \u03C7\u00B2 test with Cramer V effect size statistic. P values corrected for multiple testing with the false discovery rate method.'), 
           part = 'header', 
           ref_symbols = 'b') %>% 
  theme_vanilla

```

<hr style = "border-top: 5px solid DarkGray" />

## Hormonal subsets of testicle cancer, result summary

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-classes-summary, fig.width = figur::convert(figures$classes_summary, to = 'in')$w, fig.height = figur::convert(figures$classes_summary, to = 'in')$h, fig.cap = 'Key characteristic of the hormonal subsets of testicle cancer.'}

figures$classes_summary$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-classes-summary). Key characteristic of the hormonal subsets of testicle cancer.</b>
</p>

<hr style = "border-top: 5px solid #417a8b" />

# Prognostic significance of pre-surgery sex hormone levels

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-uni-cox, fig.width = figur::convert(figures$uni_cox, to = 'in')$w, fig.height = figur::convert(figures$uni_cox, to = 'in')$h, fig.cap = 'Modeling of relapse-free survival as a function of pre-surgery sex hormone levels by uni-variable Cox regression.'}

figures$uni_cox$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-uni-cox). Modeling of relapse-free survival as a function of pre-surgery sex hormone levels by uni-variable Cox regression.</b>
<br>
Effects of pre-surgery levels of blood hormones expressed as clinical strata and numeric variables on relapse-free survival were investigated by univariable Cox regression. For the numeric variables, two types of models were constructed: with solely first-order term and both first- and second-order terms to account for non-linear association of the hormone levels with survival. The numeric explanatory variables were normalized and median-centered prior to modeling. The Cox model estimates expressed as hazard ratios (HR) with 95% confidence intervals (95% CI) are shown in Forest plots. Total numbers of observations and numbers of cases in the strata are indicated in the Y axes. Color of the points and whiskers codes for significance and sign of association of the variable with relapse risk. Note that none of the investigated parameters was found significantly associated with relapse risk.
</p>

<hr style = "border-top: 1px solid DarkGray" />

```{r tab-elastic-net, tab.cap = 'Explanatory variables in multi-parameter Elastic Cox modeling of relapse-free survival.'}

flextable::flextable(tables$elastic_net) %>% 
  width(1, width = 14, unit = 'cm') %>% 
  footnote(1, 1, 
           value = as_paragraph('sqrt: squared root; PRL: prolactin; T: testosterone; E2: estradiol; FSH: follicle stimulating hormone; LH: luteinizing hormone; HCG: homan chorionic gonadotropin; LDH: lactate dehydrogenase; CS Lugano: Lugano class; RTI: rete testis invasion; SemiCa: saminoma cancer histology; ECa: embryonic cancer histology; RLA: retroperitoneal lymphadenectomy; LVI: lymphovascular invasion.'), 
           part = 'header', 
           ref_symbols = 'a') %>% 
  theme_vanilla

```

<hr style = "border-top: 1px solid DarkGray" />

```{r fig-multi-cox, fig.width = figur::convert(figures$multi_cox, to = 'in')$w, fig.height = figur::convert(figures$multi_cox, to = 'in')$h, fig.cap = 'Multi-parameter Elastic Net Cox modeling of effects of pre-surgery sex hormone levels on relapse-free survival.'}

figures$multi_cox$plot

```

<p class = "legend">
<b>Figure \@ref(fig:fig-multi-cox). Multi-parameter Elastic Net Cox modeling of effects of pre-surgery sex hormone levels on relapse-free survival.</b>
<br>
Association of demographic, clinical, pathological, therapy-related and endocrinologic explanatory variables with relapse-free survival was investigated by Elastic Net Cox regression and corroborated by 10-fold cross-validation (CV).
<br>
(A) Coefficients of the Elastic Net model expressed as hazard ratios (HR). Point sizes code for absolute values of log(HR). Point colors code for log(HR) values.
<br>
(B) Performance of the model measured by Harrell's concordance index (C), model calibration assessed by Brier Score (Integrated Brier Scores [IBS] presented in the plot caption) and survival in tertiles of the Elastic Net model's linear predictor score visualized in a Kaplan-Meier plot (significance assessed by log-rank test).
</p>

<hr style = "border-top: 5px solid #417a8b" />

# Methods

## Data sources

The study dataset was provided as an Excel sheet. 
Data import in R was accomplished with the `read_xslx()` R function (package _readxl_) [@Wickham2022]
. 
The dataset was formatted with an in-house developed script. 

Predominantly embryonic cancers, predominantly teratoma, predominantly yolk sac cancers and predominantly chorionic cancers were defined by the cutoff of $\geq$ 75% of the respective histology in pathological examination. 
Tumor stages and Lugano classes were expressed in simplified form as 'I', 'II', 'III'. 
Laboratory parameter values beyond the detection range were set to their respective lower and upper detection limit. 
For record with the last follow-up date provided but missing relapse index, the relapse-free status was assumed. 
For relapse-free cases with missing relapse dates, the relapse dates were set to 2023/03/22, i.e. the latest dataset update. 
In cases of missing testosterone replacement variable with provided dates of the replacement therapy, the testosterone replacement therapy was assumed to be present.

Laboratory parameters were stratified as follows:

* lactate dehydrogenase (LDH): normal: 0 - 150 U/L, elevated: > 150 U/L
* alpha fetoprotein: normal: 0 - 7 ng/mL, elevated: > 7 ng/mL
* human chorionic gonadotropin (HCG): normal: 0 - 2 IU/L, elevated: > 2 IU/L
* total testosterone (T total): low: 0 - 3.5 ng/mL, normal: 3.5 - 9 ng/mL, elevated: > 9 ng/mL
* estradiol (E2): low: 0 - 20 pg/mL, normal: 20 - 55 pg/mL, elevated: > 55 pg/mL
* follicle stimulating hormone (FSH): low: 0 - 1 mU/mL, normal: 1 - 10 mU/mL, elevated: > 10 mU/mL
* luteinizing hormone (LH): low: 0 - 1.7 mU/mL, normal: 1.7 - 8.6 mU/mL, elevated: > 8.6 mU/mL
* prolactin (PRL): normal: 0 - 480 µU/mL, elevated: > 480 µU/mL

Tumor marker positivity was defined as at least one of AFP or HCG being elevated according to the cutoffs presented above.

A list of study variables with stratification scheme is provided in __Table \@ref(tab:tab-study-vars)__.

## Software

Data analysis was done with R version 4.2.3.

Tabular data was handled with the _tidyverse_ package bundle [@Wickham2019], _rlang_ [@Henry2022] and [_trafo_](https://github.com/PiotrTymoszuk/trafo).
Text data manipulation and search was accomplished with _stringi_ [@Gagolewski2021]. 

Descriptive statistics were computed with _DescTools_ [@Signorell2022], _rstatix_ [@Kassambara2021] and [_ExDA_](https://github.com/PiotrTymoszuk/ExDA). 
Statistical hypothesis testing was done for numeric and categorical variables with the packages _rstatix_ [@Kassambara2021] and [_ExDA_](https://github.com/PiotrTymoszuk/ExDA), and with the _survival_ [@Therneau2000] and _survminer_ [@Kassambara2016] packages for survival data.

Principal component analysis (PCA) was performed with the development package [_clustTools_](https://github.com/PiotrTymoszuk/clustTools) employing the pcaPP algorithm by Croux et al. [@Croux2007; @Todorov2013]. 
Multi-dimensional correspondence analysis (MCA) was done with the _MASS_ package [@Ripley2022].

Hormonal subsets of testicle cancer were defined by maximum-likelihood latent class analysis done with _poLCA_ [@Bandeen-roche1997; @Linzer2011].

Multi-parameter classifiers for cancer histology types and hormonal subsets of testicle cancer were established with the conditional Random Forest algorithm [@Strobl2007; @Hothorn2006] provided by the package _party_ [@Hothorn2022]. 
For cross-validation, computation of fit statistics and quality control of the Random Forest models, the packages _caret_ [@Kuhn2008], _plotroc_ [@Sachs2017] and the development package [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra). 

For univariable survival Cox modeling, the packages _survival_ [@Therneau2000] and [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions) were employed. 
Multi-parameter survival modeling was done with the Elastic Net cox algorithm implemented by the _glmnet_ package [@Friedman2010; @Zou2005; @Simon2011].

Analysis results were visualized with _ggplot2_ [@Wickham2016] (bar and scatter plots), [_ExDA_](https://github.com/PiotrTymoszuk/ExDA) (violin, stack and radar plots), [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra) and _plotroc_ [@Sachs2017] (receiver-operating characteristic [ROC], heat maps of confusion matrices), _survminer_ [@Kassambara2016] and [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions) (Kaplan-Meier and Brier Score plots), and [_clustTools_](https://github.com/PiotrTymoszuk/clustTools) (PCA loadings and MCA column factors). 
Report figures were generated with _cowplot_ [@Wilke2019]. 
Tables were created with _flextable_ [@Gohel2022]. 

The analysis report was written in the _rmarkdown_ environment [@Allaire2022] with the package _bookdown_ [@Xie2016]. 
Management of figures, tables, links and references in the rmarkdown document was accomplished with [_figur_](https://github.com/PiotrTymoszuk/figur).
The report was rendered as a html document with _knitr_ [@Xie2022] and _rmdformats_ [@Barnier2022]. 

## Statistical significance and multiple testing adjustment

If not indicated otherwise, statistical testing p values were corrected for multiple testing with the false discovery rate method (FDR) [@Benjamini1995] within each analysis task. 
Effects with FDR-corrected p < 0.05 are considered statistically significant.

## Explorative data analysis

In the first step of explorative data analysis, fractions of missing observations per participant and study variable were determined. 
Information content or variability of study variables was assessed with Gini coefficient (function `Gini()`, package _DescTools_) (__Figure \@ref(fig:fig-gini)__, __Table \@ref(tab:tab-miss-inf)__). 
Normality of distribution of numeric variables without any transformation and upon logarithm (log) and squared root transformation (sqrt) was assessed by Shapiro-Wilk test (function `explore(what = 'normality')`, package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)) and quantile-quantile plots (QQ plots, function `explore(what = 'plots', type = 'qq')`, package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)). 
The optimal normality-stabilizing transformations are listed in __Table \@ref(tab:tab-best-transformation)__ and shown in __Figure \@ref(fig:fig-normality)__. 
Descriptive characteristic of the cohort was generated with the `explore(what = 'table', pub_styled = TRUE)` function (package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)) and is presented in __Table \@ref(tab:tab-cohort-demo-cancer)__ and __Table \@ref(tab:tab-cohort-hormones)__.

## Comparison of seminoma and non-seminomatous germ cell tumors

Demographic, clinical, pathological, therapy-related and endocrinologic parameters were compared between the histology types with Mann-Whitney test and r effect size statistic (numeric variables) or $\chi^2$ test with Cramer V effect size statistic (function `compare_variables()`, package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)). 
The comparison results are presented in __Table \@ref(tab:tab-histology-demo-cancer)__ and __Table \@ref(tab:tab-histology-hormones)__.
Differences in survival between the histology types were analyzed with log-rank test (function `surv_pvalue()`, package _survminer_, __Figure \@ref(fig:fig-histology-survival)__).

## Multi-parameter signature of the histology types of testicle cancer

The multi-parameter model discriminating between the tumor histology types employing a wide range of demographic, clinical, pathological and endocrinologic explanatory variables (available observations: n = `r nrow(histo_class$analysis_tbl)`, __Figure \@ref(fig:fig-histology-class)__) was constructed with the conditional Random Forest algorithm [@Hothorn2022; @Hothorn2006; @Strobl2007] using the `train(method = 'cforest')` wrapper function from the package _caret_. 
The optimal value of the `mtry` parameter (mtry = `r histo_class$model$bestTune$mtry[1]`) defining the size of random variable subset for tree model construction was found by 10-fold cross-validation of Random Forest models with varying parameter values. 
The parameter choice criterion was minimal value of Cohen's $\kappa$ in the cross-validation. 
The remaining model parameters such as split rule (set to the maximum test statistic), splitting criterion (set to 1.28) and number of random trees (500) were specified by the control objects returned by the `cforest_classical()` function from the package _party_. 

Performance statistics such as area under the ROC curve, sensitivity, specificity, Cohen's $\kappa$ and $R^2$ were retrieved from the model with the `summary()` method (package [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra)). 
ROC curves for the Random Forest classifier in the training data and cross-validation were generated with the `plot(type = 'roc')` method (package [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra)). 
Brier Scores for particular observations serving as a measure of model calibration were calculated with the following formula:

$$BS_i = (fitted_i - outcome_i)^2$$

where $BS_i$ stands for the Brier Score for the i-th observation. 
Integrated Bries Score (IBS) was computed as the arithmetic mean of all available Brier Scores:

$$IBS = \frac{1}{N}\sum_i^N(fitted_i - outcome_i)^2$$

The key model performance statistics are presented in __Figure \@ref(fig:fig-histology-class)B__.

Importance of the Random Forest model's explanatory variables was expressed as difference in out-of-bad (OOB) accuracy of the original model and a model with the particular variable randomly reshuffled (permutation importance, computed by `varimp()`, package _party_, __Figure \@ref(fig:fig-histology-class)A__). 


## Components of pre-surgery sex hormone levels

Trends or components of pre-surgery sex hormone levels treated as normalized, median-centered numeric variables were investigated by 4-dimensional PCA [@Croux2007; @Todorov2013] (function `reduce_data(kdim = 4, red_fun = 'pca')`). 
The first four components of the PCA explained >90% of the entire hormone dataset variance as investigated by visual analysis of the scree plot (not shown). 
PCA loadings for the first two major principal components were visualized with the `plot(type = 'loadings')` method (package [_clustTools_](https://github.com/PiotrTymoszuk/clustTools)). 

Trends or overlaps in strata of sex hormone levels (categorical variables) were explored by two-dimensional MCA performed with the `mca()` function from the _MASS_ package [@Ripley2022]. 
Column factors were visualized with a custom script. 

A total of n = `r nrow(pca$analysis_tbl)` observations were available for these analysis. 
The results of component and correspondence analysis are presented in __Figure \@ref(fig:fig-hormone-components)__.

## Definition of hormonal subsets with latent class analysis

To define subsets of testicle cancers based on clinical strata of pre-surgery sex hormone levels (categorical variables, available observations: n = `r nrow(lca$analysis_tbl)`) termed further 'hormonal subsets', latent class analysis was employed (LCA, 5000 iterations, 5 algorithm runs, function `poLCA(maxiter = 5000, nrep = 5)`, package _poLCA_) [@Bandeen-roche1997; @Linzer2011].

The optimal number of hormonal subsets was determined by comparing values of Bayesian Information Criterion (BIC) for LCA models with varying number of classes. 
The LCA solution with k = 3 classes/hormonal subsets displayed the minimal BIC value suggestive of the optimal model fit. 
Convergence of this model was achieved in n = `r lca$model$numiter` iterations out of 5000 iterations in total. 
Posterior probabilities of assignment to particular hormone subsets and the final hormone assignment scheme (defined by the maximal posterior probability/modal assignment) are presented in __Table \@ref(tab:tab-lca-posterior)__ available as a supplementary Excel file.

Differences in distribution of sex hormone strata between the hormone subsets were assessed by $\chi^2$ test with Cramer V effect size statistic. 
Differences in blood hormone concentrations expressed as numeric variables between the hormone subsets were investigated by Kruskal-Wallis test with $\eta^2$ effect size statistic (both comparison types done with `compare_variables()`, package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)). 

## Demographic and clinical characteristic of the hormonal subsets

Demographic, clinical, pathological and therapy-related parameters were compared between the hormonal subsets with Kruskal-Wallis test and $\eta^2$ effect size statistic (numeric variables) or $\chi^2$ test with Cramer V effect size statistic (function `compare_variables()`, package [_ExDA_](https://github.com/PiotrTymoszuk/ExDA)). 
The comparison results are presented in __Table \@ref(tab:tab-classes)__. 
Additionally, neutral and pituitary hormonal subset patients were split according to their AFP and HCG status (negative for both AFP/HCG versus positive for AFP or HCG) and differences between the status strata compared with Mann-Whitney test with r effect size statistic or $\chi^2$ test with Cramer V effect size statistic, as appropriate. 
Significant differences identified in this analysis are presented in __Table \@ref(tab:tab-classes-markers)__.

Differences in survival between the hormone subsets were analyzed with log-rank test (function `surv_pvalue()`, package _survminer_, __Figure \@ref(fig:fig-classes-survival)__).

## Multi-paramater discrimination between the hormonal subsets

A multi-parameter model allowing for discrimination between the hormone subsets with solely non-endocrine explanatory variables (available observations: n = `r nrow(class_rf$analysis_tbl)`, __Figure \@ref(fig:fig-classes-random-forest)A__) was established with the conditional Random Forest algorithm as described above for the histology types. 
The optimal `mtry` parameter value obtained by cross-validation-based tuning with Cohen's $\kappa$ as the tuning metric was `r class_rf$model$bestTune$mtry[1]`. 
Model performance in the training dataset and 10-fold cross-validation was assessed by the accuracy and Cohen's $\kappa$ statistics computed with the `summary()` method (package [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra)) and are presented in __Figure \@ref(fig:fig-classes-random-forest)B__. 
Confusion matrices of the predicted and actual hormone subset assignment were visualized with the `plot(type = 'confusion')` method provided by the [_caretExtra_](https://github.com/PiotrTymoszuk/caretExtra) package.
Permutation importance for explanatory variables was computed as described for the  histology types and is presented in __Figure \@ref(fig:fig-classes-random-forest)A__.

## Survival modeling

Effects of pre-surgery sex hormone levels expressed as numeric or factor variables on relapse-free survival was explored by univariable Cox regression (functions `coxph()` and `as_coxex()`, packages _survival_ and [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions)) [@Therneau2000]. 
To improve normality of numeric explanatory variables, the square root transformation was applied (__Table \@ref(tab:tab-best-transformation)__). 
Numeric variables were included in the models as solely first-order terms and as both first- and second-order terms to account for non-linear association between the explanatory variable and relapse-free survival. 
Numeric variables were additionally normalized prior to modeling. 
Model's proportional hazard assumption was checked with the `summary(type = 'assumptions')` method employing provided by the [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions) package and employing the original `zph()` algorithm [@Grambsch1994].
Model fit stats (Harrell's concordance index [C], $R^2$, Integrated Brier Score [IBS]) [@Graf1999; @Harrell1996] were computed with the `summary(type = 'fit')` for the training data and with the `validate()` method for 10-fold cross validation (package [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions)). 
Model estimates expressed as hazard ratios (HR) with their confidence intervals and statistical significance assessed by z test were calculated with the `summary(type = 'inference')` method from the [_coxExtensions_](https://github.com/PiotrTymoszuk/coxExtensions) package.

Multi-parameter survival regression was done with the Elastic Net Cox algorithm implemented by the _glmnet_ package [@Friedman2010; @Zou2005; @Simon2011]. 
The initial explanatory variable set encompassed `r length(multi_cox$variables)` demographic, clinical, pathological and endocrinologic variables listed in __Table \@ref(tab:tab-elastic-net)__. 
Pre-processing of numeric variables was identical as in case of the univariate survival modeling. 
The optimal value of the shrinkage factor $\lambda$ ($\lambda$ = `r signif(multi_cox$opt_lambda$lambda, 2)`) was found by 100-repeats 10-fold cross-validation done with the `cv.glmnet()` function (package _glmnet_) and corresponded to the minimal cross-validated model deviance. 
The final Elastic Net model was constructed for the optimal $\lambda$ parameter with the `glmnet()` function (package _glmnet_). 
HR values for the non-zero model estimates were retrieved with the `coef()` method and visualized in __Figure \@ref(fig:fig-multi-cox)A__. 
Subsequently, the association of the linear predictor score of the glmnet model with relapse-free survival was assessed by canonical univariable Cox regression as described above. 
Concordance of the Elastic Net model was assessed by Harrell's C index, model calibration was investigated by plotting Brier scores as a function of survival time and visual analysis of relapse-free survival in tertiles of the Elastic Net model linear score (__Figure \@ref(fig:fig-multi-cox)S__).

<hr style = "border-top: 5px solid #417a8b" />

# Data and code availability

The analysis dataset entire R analysis pipeline is available as a [GitHub repository](https://github.com/PiotrTymoszuk/TesCa_hormones).

<hr style = "border-top: 5px solid #417a8b" />

# References